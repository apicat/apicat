var re=Object.defineProperty;var q=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var H=(e,o,n)=>o in e?re(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,D=(e,o)=>{for(var n in o||(o={}))ae.call(o,n)&&H(e,n,o[n]);if(q)for(var n of q(o))ie.call(o,n)&&H(e,n,o[n]);return e};import{O as ue,z as ce,P as de,a as pe,e as K,f as W,h as X,g as _e,Q as me,R as fe,i as Z,j as ee,J as he,K as Ee,l as ve,E as J,S as ge,G as Pe,I as je,v as ke}from"./element-plus.33434d3d.js";import{_ as we,a as Ce}from"./ImagePreview.71f5f246.js";import{D as be,e as z,f as G,g as Ae,h as Se,$ as Re,b as $,j as ye,k as a,l as Oe,n as Ie,o as Fe,d as Y,p as Le,q as De,r as Be,u as Me,t as Ve,v as Ne,w as Ue,x as Te}from"./index.0b92b67b.js";import{a3 as Ge,aj as $e,bd as xe,a1 as V,o as k,V as N,W as s,Y as t,Z as oe,ab as y,aU as te,f as P,e as R,an as x,T as B,d as se,aY as qe,r as j,a_ as He,v as ne,aq as Je,x as ze,Q as Ye,u as M,_ as Q,aS as Qe,aT as Ke}from"./vendor.1b70e788.js";const T="/static/icon-project.png",We={setup(){const e=Ge({isShow:!1,PROJECT_DEFAULT_ICON:T,isLoading:!1,imgUrl:null,file:null,disableType:!1,docTypes:be,form:{icon_link:T,name:"",type:z.API.value,visibility:0,description:""},rules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u9879\u76EE\u540D\u79F0",trigger:"blur"},{min:2,message:"\u9879\u76EE\u540D\u79F0\u4E0D\u80FD\u5C11\u4E8E\u4E24\u4E2A\u5B57",trigger:"blur"}]}});return D({},$e(e))},computed:D({},xe(G,["activeGroup"])),components:{Lock:ue,View:ce,Upload:de},watch:{isShow:function(){!this.isShow&&this.reset()}},methods:{handleUpload(e){return e.append("icon",this.file),Ae(e)},show(){this.isShow=!0},hide(){this.isShow=!1},reset(){this.$refs.projectForm.resetFields(),this.form={icon_link:T,name:"",type:z.API.value,visibility:0,description:""}},onCloseBtnClick(){this.isShow=!1,this.reset()},onImageUpload(e,o){this.imgUrl=e,this.file=o},onProjectIconUploadSuccess(e){this.form.icon_link=e},handleSubmit(e){this.$refs[e].validate(o=>{o&&(this.isLoading=!0,this.form.group_id=this.activeGroup.id,Se(this.form).then(n=>{this.$message.success(n.msg||"\u9879\u76EE\u521B\u5EFA\u6210\u529F\uFF01"),Re(this,"on-ok",n.data||{})}).catch(n=>{}).finally(()=>{this.isLoading=!1,this.hide()}))})}},emits:["on-ok"]},Xe=y("\u4E0A\u4F20\u65B0\u56FE\u6807 "),Ze=y("\u79C1\u6709 "),eo=y("\u516C\u5F00 "),oo=y(" \u53D6\u6D88 "),to=y(" \u786E \u5B9A ");function so(e,o,n,I,m,i){const v=pe,u=V("Upload"),f=K,w=W,b=we,g=X,c=_e,C=V("Lock"),h=me,p=V("View"),F=fe,O=Ce,L=Z,S=ee;return k(),N(S,{modelValue:e.isShow,"onUpdate:modelValue":o[6]||(o[6]=r=>e.isShow=r),width:440,"close-on-click-modal":!1,title:"\u65B0\u5EFA\u9879\u76EE","append-to-body":"","custom-class":"show-footer-line"},{footer:s(()=>[t(w,{onClick:o[4]||(o[4]=r=>i.onCloseBtnClick())},{default:s(()=>[oo]),_:1}),t(w,{loading:e.isLoading,type:"primary",onClick:o[5]||(o[5]=r=>i.handleSubmit("projectForm"))},{default:s(()=>[to]),_:1},8,["loading"])]),default:s(()=>[t(L,{ref:"projectForm",model:e.form,rules:e.rules,"label-position":"top",style:{width:"400px"},class:"py-2 pl-2",onSubmit:o[3]||(o[3]=oe(r=>i.handleSubmit("projectForm"),["prevent"]))},{default:s(()=>[t(g,{label:""},{default:s(()=>[t(v,{class:"mr-7",shape:"square",size:60,src:e.form.icon_link?e.form.icon_link:e.PROJECT_DEFAULT_ICON},null,8,["src"]),t(b,{onDone:i.onImageUpload},{default:s(()=>[t(w,null,{default:s(()=>[t(f,null,{default:s(()=>[t(u)]),_:1}),Xe]),_:1})]),_:1},8,["onDone"])]),_:1}),t(g,{label:"\u9879\u76EE\u540D\u79F0",prop:"name",class:"hide_required"},{default:s(()=>[t(c,{modelValue:e.form.name,"onUpdate:modelValue":o[0]||(o[0]=r=>e.form.name=r),placeholder:"\u9879\u76EE\u540D\u79F0",maxlength:"255"},null,8,["modelValue"])]),_:1}),t(g,{label:"\u6743\u9650"},{default:s(()=>[t(F,{modelValue:e.form.visibility,"onUpdate:modelValue":o[1]||(o[1]=r=>e.form.visibility=r)},{default:s(()=>[t(h,{label:0},{default:s(()=>[t(f,{class:"mr-1"},{default:s(()=>[t(C)]),_:1}),Ze]),_:1}),t(h,{label:1},{default:s(()=>[t(f,{class:"mr-1"},{default:s(()=>[t(p)]),_:1}),eo]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"\u9879\u76EE\u63CF\u8FF0"},{default:s(()=>[t(c,{modelValue:e.form.description,"onUpdate:modelValue":o[2]||(o[2]=r=>e.form.description=r),type:"textarea",autosize:{minRows:4,maxRows:4},maxlength:"255"},null,8,["modelValue"])]),_:1}),t(O,{"img-url":e.imgUrl,file:e.file,onOnOk:i.onProjectIconUploadSuccess,"handle-upload":i.handleUpload},null,8,["img-url","file","onOnOk","handle-upload"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}var no=$(We,[["render",so]]);const lo={emits:["on-ok"],data(){return{isShow:!1,isLoading:!1,form:{new_group_id:"",project_id:"",old_group_id:""},rules:{new_group_id:{required:!0,message:"\u8BF7\u9009\u62E9\u9879\u76EE\u5206\u7EC4",type:"number",trigger:"blur"}}}},watch:{isShow:function(){!this.isShow&&this.reset()}},methods:{show(e){this.form.project_id=e.id;let o=e.group_id||parseInt(this.$route.params.cid||0,10);this.form.old_group_id=isNaN(o)?0:o,this.form.new_group_id=isNaN(o)?0:o,this.isShow=!0},hide(){this.isShow=!1},onCloseBtnClick(){this.isShow=!1,this.reset()},reset(){this.form.project_id="",this.form.old_group_id="",this.form.new_group_id=""},handleSubmit(e){this.$refs[e].validate(o=>o&&this.submit())},submit(){this.isLoading=!0,ye(this.form).then(e=>{this.$Message.success(e.msg||"\u66F4\u6362\u5206\u7EC4\u6210\u529F!"),this.onCloseBtnClick(),this.$emit("on-ok")}).finally(()=>{this.isLoading=!1}).catch(e=>{})}},setup(){const e=G();return D({},te(e))}},ro=y("\u53D6\u6D88"),ao=y("\u786E\u5B9A");function io(e,o,n,I,m,i){const v=he,u=Ee,f=X,w=Z,b=W,g=ee;return k(),N(g,{modelValue:m.isShow,"onUpdate:modelValue":o[4]||(o[4]=c=>m.isShow=c),width:340,"close-on-click-modal":!1,title:"\u79FB\u52A8\u9879\u76EE\u5206\u7EC4","append-to-body":"","custom-class":"show-footer-line"},{footer:s(()=>[P("div",null,[t(b,{onClick:o[2]||(o[2]=c=>i.onCloseBtnClick())},{default:s(()=>[ro]),_:1}),t(b,{loading:m.isLoading,type:"primary",onClick:o[3]||(o[3]=c=>i.handleSubmit("teamForm"))},{default:s(()=>[ao]),_:1},8,["loading"])])]),default:s(()=>[t(w,{onSubmit:o[1]||(o[1]=oe(c=>i.handleSubmit("teamForm"),["prevent"])),ref:"teamForm",model:m.form,rules:m.rules,"label-position":"top",style:{"margin-bottom":"-19px"}},{default:s(()=>[t(f,{label:"\u9009\u62E9\u9879\u76EE\u5206\u7EC4",prop:"new_group_id",class:"hide_required"},{default:s(()=>[t(u,{class:"w-full",modelValue:m.form.new_group_id,"onUpdate:modelValue":o[0]||(o[0]=c=>m.form.new_group_id=c),"not-data-text":"\u6682\u65E0\u9879\u76EE\u5206\u7EC4","no-match-text":"\u672A\u67E5\u627E\u5230\u5206\u7EC4",placeholder:"\u9009\u62E9\u88AB\u79FB\u52A8\u7684\u9879\u76EE\u5206\u7EC4",teleported:!1,"popper-class":"w-full overflow-hidden"},{default:s(()=>[t(v,{value:0,label:"\u4E0D\u5206\u7EC4"}),(k(!0),R(B,null,x(e.projectGroupList,c=>(k(),N(v,{value:c.id,key:c.id,label:c.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}var uo=$(lo,[["render",io]]);const co=["onClick","innerHTML"],po=se({props:{ignoreEle:{default:[]}},emits:["changeGroup","quitProject","deleteProject"],setup(e,{expose:o,emit:n}){const I=e,m=qe(),i=j(!1),v=j(null),u=j({}),f=j(),w=j(),b=j(),g=j([]);He(v,l=>{const _=l.composedPath(),E=I.ignoreEle;E&&E.length>0&&E.some(d=>d&&(l.target===d||_.includes(d)))||(i.value=!1)});const c=()=>{b.value.show(u.value)},C=()=>{n("changeGroup")},h=()=>{Y({title:"\u5220\u9664\u63D0\u793A",content:"\u786E\u5B9A\u5220\u9664\u8BE5\u9879\u76EE\u5417\uFF1F",onOk:l=>Le(u.value.id).then(_=>{J.success(_.msg||"\u5220\u9664\u6210\u529F\uFF01"),n("deleteProject")}).catch(()=>{l(),n("quitProject")})})},p=()=>{Y({title:"\u9000\u51FA\u63D0\u793A",content:"\u786E\u5B9A\u9000\u51FA\u8BE5\u9879\u76EE\u5417\uFF1F",onOk:l=>De(u.value.id).then(_=>{J.success(_.msg||"\u5220\u9664\u6210\u529F\uFF01"),n("quitProject")}).catch(()=>{l(),n("quitProject")})})},F=()=>{w.value.show(u.value)},O=()=>{f.value.show({project_id:u.value.id},Be)},L=[{text:"\u9884\u89C8\u9879\u76EE",selector:"project_preview",isNewOpen:!0,href:"{id}",field:"preview_link",icon:"iconIconPopoverPlay",roles:[a.MANAGER,a.DEVELOPER]},{text:"\u9879\u76EE\u6210\u5458",selector:"project_members",href:"/project/{id}/members",icon:"iconIconPopoverUser",route:{name:"project.members"},roles:[a.MANAGER,a.DEVELOPER,a.READER]},{text:"\u5206\u4EAB\u9879\u76EE",selector:"project_share",clickFn:F,icon:"iconshare",roles:[a.MANAGER,a.DEVELOPER,a.READER]},{text:"\u5BFC\u51FA\u9879\u76EE",selector:"project_export",clickFn:O,icon:"iconIconPopoverUpload",roles:[a.MANAGER,a.DEVELOPER]},{text:"\u9879\u76EE\u8BBE\u7F6E",selector:"project_edit",href:"/project/{id}/setting",icon:"iconIconPopoverSetting",route:{name:"project.setting"},roles:[a.MANAGER]},{text:"\u9879\u76EE\u5206\u7EC4",selector:"project_group",clickFn:c,icon:"iconfenzu",roles:[a.MANAGER,a.DEVELOPER,a.READER]},{text:"\u5220\u9664\u9879\u76EE",selector:"project_delete",clickFn:h,icon:"iconIconPopoverAlert",roles:[a.MANAGER]},{text:"\u9000\u51FA\u9879\u76EE",selector:"project_quit",clickFn:p,icon:"iconIconPopoverExit",roles:[a.DEVELOPER,a.READER]}],S={};[a.MANAGER,a.DEVELOPER,a.READER].forEach(l=>{const _=S[l]=S[l]||[];L.forEach(E=>{E.roles.join(",").indexOf(l)!==-1&&_.push(E)})});const r=()=>{let _=(Fe.find(d=>d.value===u.value.authority)||{}).key,E=S[_]||[];_===a.READER&&!u.value.visibility&&(E=E.filter(d=>d.selector!=="project_share")),g.value=E.map(d=>{let A=D({},d);return A.href&&(A.href=A.href.replace("{id}",u.value[d.field||"id"])),A.menuHtml=`<i class="icon iconfont mr-1 ${A.icon||""}"></i>${A.text}`,A})},U=l=>{if(l.clickFn){l.clickFn();return}if(l.isNewOpen){window.open(l.href);return}l.href&&!l.isNewOpen&&(l.route.params={project_id:u.value[l.field||"id"]},m.push(l.route))},le=(l,_)=>{v.value=l,u.value=_,i.value=!0};return ne(u,()=>{r()}),o({show:le}),(l,_)=>{const E=ve;return k(),R(B,null,[t(E,{visible:i.value,"onUpdate:visible":_[0]||(_[0]=d=>i.value=d),ref:"popoverRef","popper-class":"ac-popper-menu","virtual-ref":v.value,"virtual-triggering":"",width:"auto"},{default:s(()=>[P("ul",null,[(k(!0),R(B,null,x(g.value,d=>(k(),R("li",{class:"ac-popper-menu__item",key:d.selector,onClick:A=>U(d),innerHTML:d.menuHtml},null,8,co))),128))])]),_:1},8,["visible","virtual-ref"]),t(Oe,{ref_key:"projectExportModal",ref:f},null,512),t(Ie,{ref_key:"projectShareModal",ref:w},null,512),t(uo,{ref_key:"changeProjectGroupModal",ref:b,onOnOk:C},null,512)],64)}}});const _o=e=>(Qe("data-v-7e014a70"),e=e(),Ke(),e),mo={class:"truncate"},fo={class:"ac-project"},ho={class:"ac-project-thumb"},Eo=["src"],vo=["onClick"],go=["title"],Po={class:"ac-project-thumb"},jo=_o(()=>P("p",null,"\u65B0\u5EFA\u9879\u76EE",-1)),ko=se({setup(e){const[o,n]=Me(Ve,{isShowMessage:!1}),I=G(),{activeGroup:m}=te(I),i=j([]),v=j(),u=j(),f=j([]),w=h=>{f.value.push(h)},b=(h,p)=>{u.value.show(h.currentTarget,p)},g=()=>{v.value.show()},c=async()=>{await C()},C=async()=>{const{data:h}=await n(m.value.id);h&&(i.value=(h.projects||[]).map(p=>(p.isBlank=!1,p.publicHref=Ne({project_id:p.id}),p.authority===Ue.READER&&(p.isBlank=!0,p.publicHref=Te({project_id:p.id})),p)))};return ne(()=>m.value,async()=>await C()),Je(()=>{f.value=[]}),ze(async()=>{await C()}),(h,p)=>{const F=V("router-link"),O=K,L=je,S=ke;return k(),R(B,null,[Ye((k(),N(L,{shadow:"never"},{header:s(()=>[P("div",mo,Q(M(m).name),1)]),default:s(()=>[P("div",fo,[(k(!0),R(B,null,x(i.value,r=>(k(),R("div",{class:"ac-project-item",key:r.id},[P("div",ho,[t(F,{title:r.publicHref,to:{path:r.publicHref},target:r.isBlank?"_blank":"_self"},{default:s(()=>[P("img",{src:r.icon},null,8,Eo)]),_:2},1032,["title","to","target"]),P("span",{class:"ac-project-action",ref_for:!0,ref:w,onClick:U=>b(U,r)},[t(O,null,{default:s(()=>[t(M(ge))]),_:1})],8,vo)]),P("p",{title:r.name,class:"ac-project-title truncate"},Q(r.name),9,go)]))),128)),P("div",{class:"ac-project-item ac-project-new",onClick:g},[P("div",Po,[t(O,{size:26},{default:s(()=>[t(M(Pe))]),_:1})]),jo])])]),_:1})),[[S,M(o)]]),t(no,{ref_key:"newProjectModal",ref:v,onOnOk:c},null,512),t(po,{ref_key:"projectDropmenu",ref:u,onChangeGroup:C,onDeleteProject:C,onQuitProject:C,"ignore-ele":f.value},null,8,["ignore-ele"])],64)}}});var Ro=$(ko,[["__scopeId","data-v-7e014a70"]]);export{Ro as default};
